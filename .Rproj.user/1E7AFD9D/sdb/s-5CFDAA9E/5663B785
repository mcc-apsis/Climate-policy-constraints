{
    "collab_server" : "",
    "contents" : "---\ntitle: \"Mapping transition challenges\"\noutput: \n  html_document:\n    df_print: paged\n---\n\n```{r include=FALSE}\n\nrm(list=ls())\n\nlibrary(tidyverse)\nlibrary(gridExtra)\nlibrary(xlsx)\nlibrary(zoo)\nlibrary(classInt)\nlibrary(scales)\nlibrary(GGally)\nlibrary(ggfortify)\nlibrary(knitr)\nlibrary(kableExtra)\nlibrary(grid)\n\nload('Data/pe.RData')\n\n\n############### join SWIID ###############\n\nload('C:\\\\Users\\\\lamw\\\\Google Drive\\\\Work\\\\Code\\\\R\\\\Database\\\\SWIID\\\\SWIID.RData')\npe <- left_join(pe,swiid_summary %>% select(ISO,year,gini_disp),by=c(\"ISO\"=\"ISO\",\"Year\"=\"year\"))\n\nrm(swiid_summary)\n\n############### join regional values surveys ###############\n\nload('Data/RVS.RData')\npe <- left_join(pe,RVS %>% select(ISO,Year,trust),by=c(\"ISO\"=\"ISO\",\"Year\"=\"Year\"))\n\nrm(RVS)\n\n############### prepare map ###############\n\nlibrary(ggmap)\nlibrary(maps)\nlibrary(mapdata)\n\nworld <- map_data(\"world\") %>%\n  filter(region != \"Antarctica\") %>%\n  mutate(region=tolower(region))\n\nisos <- read.xlsx(file=\"C:\\\\Users\\\\lamw\\\\Google Drive\\\\Work\\\\Code\\\\MATLAB\\\\Handy code\\\\ISOcodes.xls\",sheetName=\"3 letter codes\",startRow = 3,colIndex=7:8,header=FALSE)\nnames(isos) = c(\"country\",\"iso\")\nisos <- isos %>% mutate(country=tolower(country))\n\nworld <- left_join(world,isos,by=c(\"region\"=\"country\"))\n\nrm(isos)\n############### prepare data ###############\n\n### sum coal and lignite production, bring to latest year\npe <- pe %>% \n  group_by(Country) %>% \n  mutate(fossil_coal_hard_production=na.locf(fossil_coal_hard_production,na.rm=FALSE)) %>% \n  mutate(fossil_coal_lignite_production=na.locf(fossil_coal_lignite_production,na.rm=FALSE)) %>% \n  mutate(fossil_coal_hard_RSV=na.locf(fossil_coal_hard_RSV,na.rm=FALSE)) %>% \n  mutate(fossil_coal_lignite_RSV=na.locf(fossil_coal_lignite_RSV,na.rm=FALSE)) %>% \n  group_by(Country,Year) %>% \n  mutate(coal_production=sum(fossil_coal_hard_production,fossil_coal_lignite_production,na.rm = TRUE)) %>% \n  mutate(coal_reserves=sum(fossil_coal_lignite_RSV,fossil_coal_hard_RSV,na.rm=TRUE)) %>% \n  mutate(coal_production=ifelse(coal_production==0,NA,coal_production)) %>% \n  mutate(coal_reserves=ifelse(coal_reserves==0,NA,coal_reserves))\n  \n\n### sum infrastructure access, bring to latest year\npe <- pe %>% \n  group_by(Country) %>% \n  mutate(infra_elec_WB=na.locf(infra_elec_WB,na.rm=FALSE)) %>% \n  mutate(infra_water_WB=na.locf(infra_water_WB,na.rm=FALSE)) %>% \n  mutate(infra_sanitation_WB=na.locf(infra_sanitation_WB,na.rm=FALSE)) %>% \n  group_by(Country,Year) %>% \n  mutate(infra_access=mean(c(infra_elec_WB,infra_water_WB,infra_sanitation_WB)))\n  \n\n### elec shares\npe <- pe %>% \n  group_by(Country) %>% \n  mutate(ene_share_coal=ene_coal_tpes_IEA/ene_tot_tpes_IEA) %>% \n  mutate(ene_share_gas=ene_gas_tpes_IEA/ene_tot_tpes_IEA) %>% \n  mutate(ene_share_oil=ene_oil_tfec_IEA/ene_tot_tfec_IEA)\n\npe <- pe %>% \n  group_by(Country) %>% \n  mutate(gdp_ppp_pc=gdp_ppp_WB/pop_UN) %>% \n  mutate(co2_terr_pc=co2_terr_GCB/pop_UN)\n\n```\n\n```{r include=FALSE}\n\n##### select variables\nvars <- c(\"rrents_tot_WB\",\"ene_share_coal\",\"ene_share_oil\",\"ene_share_gas\",\"gov_corrupt_WGI\",\"gov_effect_WGI\",\"gini_disp\",\"frac_ethnic\",\"trust\")\ngroup <- c(\"vested\",\"vested\",\"vested\",\"vested\",\"capacity\",\"capacity\",\"social\",\"social\",\"social\")\nrisk <- cbind(as.data.frame(vars),group) %>% \n  mutate(vars=as.character(vars))\n\nch <- pe %>% \n  select(c(\"Country\",\"ISO\",\"Year\",\"region_IAM10\",\"region_RCP5\",risk$vars,\"pop_UN\"))\n\nrm(vars,group)\n#### bring data to latest year [DO SOME CHECKS HERE] ####\n\nch <- ch %>% \n  group_by(Country) %>% \n  mutate_all(funs(na.locf(.,na.rm=FALSE))) %>% \n  ungroup() %>% \n  filter(Year==2015) %>% \n  filter(Country!=\"World\") %>% \n  filter(pop_UN>1000000) %>% \n  select(-pop_UN)\n\n\n```\n\n```{r maps,echo=FALSE,warning=FALSE,fig.width=10,fig.path=\"Plots/\",dev=c('png','pdf')}\n\n\nmapdata <- left_join(world,ch,by=c(\"iso\"=\"ISO\"))\n# reverse direction of WGI indicators, for interpretability\nmapdata <- mapdata %>% \n  mutate(gov_corrupt_WGI=-gov_corrupt_WGI) %>% \n  mutate(gov_effect_WGI=-gov_effect_WGI)\n\nplmaps <- list()\n\nfor(i in 1:length(risk$vars)) {\n  \n  z <-  paste0(\"paste(\", paste0('', c(\"region\", \"group\"), collapse = \", \"), \")\")\n  \n  plmaps[[i]] <- mapdata %>% \n    ggplot(.,aes_string(\"long\",\"lat\",group=z,fill=risk$vars[[i]])) +\n    geom_polygon(color=\"white\") +\n    theme_minimal() +\n    theme(axis.title = element_blank(),axis.text = element_blank(),panel.border = element_rect(color='grey',fill='NA')) +\n    xlim(-180,180) +\n    coord_fixed(1) +\n    scale_fill_gradient(na.value = 'grey',high = \"#132B43\", low = \"#56B1F7\") +\n    theme(legend.position=\"bottom\")\n  \n  rm(z)\n  \n  plot(plmaps[[i]])\n}\n\nblarg <- gather(mapdata,key,value,risk$vars)\nblarg %>% \n  ggplot(.,aes(x=long,y=lat,group = paste(region,group),fill=value)) +\n  geom_polygon(color=\"white\") +\n  facet_wrap(key ~.)+\n  theme_minimal() +\n  theme(axis.title = element_blank(),axis.text = element_blank(),panel.border = element_rect(color='grey',fill='NA')) +\n  xlim(-180,180)\n\n\n#do.call(grid.arrange,c(plmaps,ncol=1))\n\nsummary_vars <- gather(ch,key,value,risk$vars) %>% \n  group_by(key) %>% \n  summarise_at(\"value\",funs(n=sum(!is.na(.)),mean=mean(.),min=min(.),max=max(.)),na.rm=TRUE)\n\n#summary_vars$mean[1] <- format(summary_vars$mean[1],digits=3,scientific=FALSE) \n\nkable(summary_vars, format = \"html\", caption=\"Summary statistics\",digits=1) %>%\n  kable_styling()\n\nrm(plmaps,summary_vars)\n```\n\n```{r stats,echo=FALSE,warning=FALSE,fig.width=8,fig.height=8,fig.path=\"Plots/\",dev=c('png','pdf')}\n\n### histograms ###\n\ngather(ch,key,value,risk$vars) %>% \n  ggplot(.,aes(x=value)) +\n  geom_histogram(bins=20) +\n  facet_wrap(. ~ key,scales=\"free\") +\n  theme(axis.title = element_blank())\n\n### correlation plots ### \n\nch %>%\n  # mutate(gov_effect_WGI=-gov_effect_WGI) %>% \n  # mutate(gov_corrupt_WGI=-gov_corrupt_WGI) %>% \n  select(risk$vars) %>%\n  ggcorr(method=c(\"na.or.complete\",\"spearman\"),label=TRUE,label_size=4,label_alpha=TRUE,hjust = 0.85,size = 4, color = \"grey50\",\n         layout.exp = 2)\n\nch %>%\n  select(risk$vars) %>%\n  ggpairs(progress = FALSE)\n\n```\n\n\n```{r ipcc_regions,echo=FALSE,warning=FALSE,fig.width=10,fig.height=8,fig.path=\"Plots/\",dev=c('png','pdf')}\n\n\n### heterogeneity by exogenous region\nregion=\"region_RCP5\"\n\ncountries <- ch %>%\n  group_by_(region) %>%\n  summarise(countries=paste(Country, collapse=\", \"))\n\nsummary_regions <- ch %>% \n  group_by_(region) %>% \n  summarise_at(risk$vars,mean,na.rm=TRUE) %>% \n  cbind(.,countries=countries$countries) %>% \n  filter_at(region,any_vars(!is.na(.)))\n\ngather(ch,key,value,risk$vars) %>% \n  filter_at(region,any_vars(!is.na(.))) %>% \n  ggplot(.,aes_string(x=region,y=\"value\",fill=region)) +\n  geom_boxplot() +\n  facet_wrap(key ~., scales=\"free\",switch=\"y\",ncol=3) +\n  theme(axis.text.x=element_blank(),axis.title.x = element_blank(),axis.ticks.x = element_blank()) +\n  theme(axis.title.y = element_blank(),strip.text.y = element_text(size = 10)) +\n  theme(legend.position = \"bottom\",legend.title = element_blank()) +\n  guides(fill = guide_legend(nrow = 1,label.position = \"bottom\",keywidth = unit(1.25,\"cm\")))\n\n\n##### transition bottlenecks\nload('Data\\\\remind.RData')\n\nvars = c(\"Emissions|CO2\",\"Policy Cost|Consumption Loss\",\"Policy Cost|GDP Loss\",\"Primary Energy|Coal\",\"Primary Energy|Gas\",\"Primary Energy|Oil\",\"Primary Energy|Fossil\",\"Subsidies|Energy|Fossil\",\"Trade|Primary Energy|Coal|Volume\",\"Trade|Primary Energy|Gas|Volume\",\"Trade|Primary Energy|Oil|Volume\",\"Population\");\n\nremind <- remind %>% \n  filter(SCENARIO==\"2C_Def\") %>% \n  mutate(REGION=replace(REGION,REGION==\"R5ASIA\",\"ASIA\")) %>% \n  mutate(REGION=replace(REGION,REGION==\"R5LAM\",\"LAM\")) %>% \n  mutate(REGION=replace(REGION,REGION==\"R5MAF\",\"MAF\")) %>% \n  mutate(REGION=replace(REGION,REGION==\"R5OECD90+EU\",\"OECD90\")) %>% \n  mutate(REGION=replace(REGION,REGION==\"R5REF\",\"REF\")) %>% \n  filter(VARIABLE %in% vars) %>% \n  select(-MODEL,-SCENARIO,-UNIT) %>% \n  filter(REGION!=\"World\")\n\nblarg <- gather(remind,year,value,'2015':'2100')\nblarg <- spread(blarg,VARIABLE,value)\nzz <- blarg %>% \n  filter(year==2020 | year==2050) %>% \n  group_by(REGION) %>% \n  mutate(CO2_reduction_rate = nth(`Emissions|CO2`,1)/nth(`Emissions|CO2`,2))\n  \nblarg <- blarg %>% \n  group_by(REGION) %>% \n  summarise(consumption_loss=sum(`Policy Cost|Consumption Loss`)/sum(`Population`),\n            GDP_cost = sum(`Policy Cost|GDP Loss`)/sum(`Population`))\n  \nrm(countries,summary_regions,vars)\n```\n\n```{r jitters,echo=FALSE,warning=FALSE,fig.width=10,fig.height= 10,fig.path=\"Plots/\",dev=c('png','pdf')}\n\n# cc <- pe %>% \n#   select(c(\"Country\",\"ISO\",\"Year\",risk$vars,\"committed_coal_planned\")) %>%\n#   mutate(committed_coal_planned=ifelse(committed_coal_planned>0,1,0)) %>% \n#   group_by(Country) %>% \n#   mutate_all(funs(na.locf(.,na.rm=FALSE))) %>% \n#   ungroup() %>% \n#   filter(Year==2015) %>% \n#   select(-Year) %>% \n#   filter(Country!=\"World\")\n# \n# \n# pl_jitt <- list()\n# \n# for(i in 1:length(risk$vars)) {\n#   \n#   pl_jitt[[i]] <- cc %>%\n#     mutate(committed_coal_planned=jitter(committed_coal_planned)) %>% \n#     ggplot(.,aes_string(x=\"committed_coal_planned\",y=risk$vars[[i]],label=\"ISO\")) +\n#     geom_boxplot(aes(group = cut_width(committed_coal_planned,0.5)),width=0.25,outlier.shape = NA) +\n#     geom_point()\n#   \n# }\n# \n# do.call(grid.arrange,c(pl_jitt,ncol=2))\n# \n# rm(cc,pl_jitt)\n```\n\n```{r cluster_analysis,echo=FALSE,warning=FALSE, fig.width=6} \n\nlibrary(cluster)\n\npc <- ch %>% \n  filter_at(vars(risk$vars),all_vars(!is.na(.))) %>% \n  column_to_rownames(var = \"Country\")\n\ncomps <- prcomp(pc %>% select(risk$vars),scale.=TRUE) # calculate principal components; Choose whether to scale\n\nscreeplot(comps, type=\"lines\",col=3)\n\nsummary_pca <- rbind(\n  SD = sqrt(comps$sdev^2),\n  Proportion = comps$sdev^2/sum(comps$sdev^2),\n  Cumulative = cumsum(comps$sdev^2 / sum(comps$sdev^2))\n) %>% \n  rbind(.,comps$rotation)\n\nkable(summary_pca, format = \"html\", caption=\"PCA analysis\",digits=2) %>%\n   kable_styling()\n\n\n\nd_dist <- dist(as.matrix(comps$x[,1:4])) ### look at heirarchical clusters\nplot(hclust(d_dist))\n\n\n######### scree plot\n\nmydata <- comps$x[,1:3]\nwss <- (nrow(mydata)-1)*sum(apply(mydata,2,var))\n  for (i in 2:15) wss[i] <- sum(kmeans(mydata,\n                                       centers=i)$withinss)\nplot(1:15, wss, type=\"b\", xlab=\"Number of Clusters\",\n     ylab=\"Within groups sum of squares\")\n\n\n# clusters <- kmeans(comps$x[,1:3],5); ### choose no. clusters & no. PCs\n# pc <- cbind(pc,cluster=clusters$cluster) ### bind clusters to dataset\n# pc$cluster <- as.factor(clusters$cluster) ### convert to factor\n\n\nclusters <- pam(comps$x[,1:4],6)\npc <- cbind(pc,cluster=clusters$cluster) ### bind clusters to dataset\npc$cluster <- as.factor(clusters$cluster) ### convert to factor\n\n\n\n```\n\n```{r clusters,echo=FALSE,warning=FALSE,fig.width=10,fig.path=\"Plots/\",dev=c('png','pdf')}\n\nautoplot(comps,loadings=TRUE,loadings.label=TRUE,data=pc,label=TRUE,colour='cluster')\n\nmapdata <- left_join(world,pc,by=c(\"iso\"=\"ISO\"))\n\nmapdata %>%\n  ggplot(.) +\n  geom_polygon(aes(long,lat,group = paste(region,group),fill=cluster),color=\"white\") +\n  theme_void() +\n  coord_fixed(1) +\n  scale_fill_discrete() +\n  labs(title=\"Typology\")\n\n```\n\n```{r time_trends,echo=FALSE,warning=FALSE,fig.width=8,fig.height=8,fig.path=\"Plots/\",dev=c('png','pdf')}\n\n\ntt <- pe %>%\n  select(c(\"Country\",\"ISO\",\"Year\",\"region_IAM10\",\"region_RCP5\",risk$vars,\"pop_UN\")) %>%\n  filter(Country!=\"World\")\n\n#1996 - 2000 average\n#2010 - 2014 average\n\ntt <- left_join(tt,pc %>% rownames_to_column(var=\"Country\") %>% select(Country,cluster),by=(\"Country\"=\"Country\"))\n\ntt <- tt %>%\n  group_by(Country,region_RCP5,cluster) %>%\n  filter(!is.na(region_RCP5)) %>% \n  mutate(gov_corrup_90s=mean(gov_corrupt_WGI[which(Year>=1996 & Year<=2000)]),\n            gov_corrup_10s=mean(gov_corrupt_WGI[which(Year>=2010 & Year<=2014)]),\n            gov_effect_90s=mean(gov_corrupt_WGI[which(Year>=1996 & Year<=2000)]),\n            gov_effect_10s=mean(gov_corrupt_WGI[which(Year>=2010 & Year<=2014)]),\n            econ_rrents_90s=mean(rrents_tot_WB[which(Year>=1995 & Year<=2000)]),\n            econ_rrents_10s=mean(rrents_tot_WB[which(Year>=2010 & Year<=2014)]),\n            gini_90s=mean(gini_disp[which(Year>=1996 & Year <=2014)]),\n            gini_10s=mean(gini_disp[which(Year>=2010 & Year <=2014)]),\n            coal_90s=mean(ene_share_coal[which(Year>=1995 & Year <=2000)]),\n            coal_10s=mean(ene_share_coal[which(Year>=2010 & Year <=2013)]),\n            oil_90s=mean(ene_share_oil[which(Year>=1995 & Year <=2000)]),\n            oil_10s=mean(ene_share_oil[which(Year>=2010 & Year <=2013)]),\n            gas_90s=mean(ene_share_gas[which(Year>=1995 & Year <=2000)]),\n            gas_10s=mean(ene_share_gas[which(Year>=2010 & Year <=2013)]))\n         \n         \n         \n         \nplots <- list()\n\nplots[[1]] <- tt %>% \n  ggplot(.,aes(x=gov_corrup_90s,y=gov_corrup_10s,fill=cluster,size=pop_UN)) + \n  geom_point(pch=21,stroke=0.5,colour=\"#636363\") +\n  scale_size_continuous(range = c(1,10)) +\n  geom_abline(intercept=0,slope=1) +\n  xlim(-2,2) +\n  ylim(-2,2) +\n  theme(legend.position=\"none\")\n  \n  \nplots[[2]] <- tt %>% \n  ggplot(.,aes(x=gov_effect_90s,y=gov_effect_10s,fill=cluster,size=pop_UN)) +\n  geom_point(pch=21,stroke=0.5,colour=\"#636363\") +\n  scale_size_continuous(range = c(1,10)) +\n  geom_abline(intercept=0,slope=1) +\n  xlim(-2,2) +\n  ylim(-2,2) +\n  theme(legend.position=\"none\")\n\nplots[[3]] <- tt %>%\n  ggplot(.,aes(x=econ_rrents_90s,y=econ_rrents_10s,fill=cluster,size=pop_UN)) +\n  geom_point(pch=21,stroke=0.5,colour=\"#636363\") +\n  scale_size_continuous(range = c(1,10)) +\n  geom_abline(intercept=0,slope=1) +\n  theme(legend.position=\"none\") +\n  xlim(0,60)+\n  ylim(0,60)\n\nplots[[4]] <- tt %>%\n  ggplot(.,aes(x=gini_90s,y=gini_10s,fill=cluster,size=pop_UN)) +\n  geom_point(pch=21,stroke=0.5,colour=\"#636363\") +\n  scale_size_continuous(range = c(1,10)) +\n  geom_abline(intercept=0,slope=1) +\n  theme(legend.position=\"none\")+\n  xlim(20,60)+\n  ylim(20,60)\n\nplots[[5]] <- tt %>%\n  ggplot(.,aes(x=coal_90s,y=coal_10s,fill=cluster,size=pop_UN)) +\n  geom_point(pch=21,stroke=0.5,colour=\"#636363\") +\n  scale_size_continuous(range = c(1,10)) +\n  geom_abline(intercept=0,slope=1) +\n  theme(legend.position=\"none\")\n\nplots[[6]] <- tt %>%\n  ggplot(.,aes(x=oil_90s,y=oil_10s,fill=cluster,size=pop_UN)) +\n  geom_point(pch=21,stroke=0.5,colour=\"#636363\") +\n  scale_size_continuous(range = c(1,10)) +\n  geom_abline(intercept=0,slope=1) +\n  theme(legend.position=\"none\")\n\nplots[[7]] <- tt %>%\n  ggplot(.,aes(x=gas_90s,y=gas_10s,fill=cluster,size=pop_UN)) +\n  geom_point(pch=21,stroke=0.5,colour=\"#636363\") +\n  scale_size_continuous(range = c(1,10)) +\n  geom_abline(intercept=0,slope=1) +\n  theme(legend.position=\"none\")\n\ndo.call(grid.arrange,c(plots,ncol=2))\n\n#rm(plots,tt)\n```\n\n\n```{r cluster_trends,echo=FALSE,warning=FALSE,fig.height=10,fig.width=10}\n\n\ncountries <- pc %>%\n  rownames_to_column(var=\"Country\") %>% \n  group_by(cluster) %>%\n  summarise(countries=paste(Country, collapse=\", \"))\n\ncluster_summary <- pc %>%\n  rownames_to_column(var=\"Country\") %>% \n  group_by(cluster) %>%\n  summarise_at(vars(risk$vars),mean) %>% \n  cbind(.,countries=countries$countries) %>% \n  select(cluster,countries,everything()) %>% \n  mutate(countries=as.character(countries))\n\ncluster_summary <- cbind(cluster_summary,mediods=rownames(clusters$medoids)) %>% \n  select(cluster,mediods,countries,everything()) %>% \n  mutate_at(risk$vars,funs(round(.,2)))\n\nkable(t(cluster_summary), format = \"html\", caption=\"blarg\",digits=1) %>%\n   kable_styling() %>%\n   scroll_box(height = \"800px\")\n\n###facet grid the trends\n\n# cluster_trend <- pe %>% \n#   select(Country,ISO,Year,risk$vars)\n# cluster_trend <- left_join(cluster_trend,pc %>% select(ISO,cluster),by=c(\"ISO\"=\"ISO\")) %>% \n#   filter(Year>1990) %>% \n#   filter(!is.na(cluster)) %>% \n#   group_by(cluster,Year) %>% \n#   summarise_at(risk$vars,mean,na.rm=TRUE) \n# \n# cluster_trend <- gather(cluster_trend,key,value,risk$vars)\n# cluster_trend %>% \n#   ggplot(.,aes(x=Year,y=value,color=cluster)) +\n#   geom_line(size=1) +\n#   facet_grid(key ~ cluster,scales=\"free\",switch=\"y\") +\n#   theme(legend.position = \"none\") +\n#   theme(axis.title=element_blank()) +\n#   scale_x_continuous(breaks=c(1990,2000,2010))\n\n\n\n```\n\n```{r cluster_risks,echo=FALSE,warning=FALSE,fig.width=8,fig.path=\"Plots/\",dev=c('png','pdf')}\n\n\nrisks <- pe %>% \n  select(Country,ISO,Year,co2_terr_GCB,committed_coal_planned,infra_access,\n         fossil_coal_hard_RSV,fossil_coal_lignite_RSV,fossil_gas_RSV,fossil_oil_RSV,pop_UN) %>% \n  group_by(Country) %>% \n  mutate_all(funs(na.locf(.,na.rm=FALSE))) %>% \n  ungroup() %>% \n  filter(Year==2015) %>% \n  filter(Country!=\"World\")\n\nrisks <- left_join(risks,pc %>% select(ISO,cluster),by=c(\"ISO\"=\"ISO\"))\n\nrisks <- risks %>%\n  mutate_at(vars(-Country,-ISO,-Year,-cluster),funs(total=sum(.)),na.rm=TRUE)\n\nrisk_summary <- risks %>% \n  group_by(cluster) %>% \n  summarise(countries=paste(Country, collapse=\",\"),\n            pop=sum(pop_UN,na.rm=TRUE)/pe$pop_UN[pe$Country==\"World\" & pe$Year==2015][1],\n            co2_terr_GCB=sum(co2_terr_GCB,na.rm=TRUE)/pe$co2_terr_GCB[pe$Country==\"World\" & pe$Year==2015][1],\n            committed_coal_planned=sum(committed_coal_planned,na.rm=TRUE)/first(committed_coal_planned_total),\n            fossil_coal_hard_RSV=sum(fossil_coal_hard_RSV,na.rm=TRUE)/first(fossil_coal_hard_RSV_total),\n            fossil_coal_lignite_RSV=sum(fossil_coal_lignite_RSV,na.rm=TRUE)/first(fossil_coal_lignite_RSV_total),\n            fossil_gas_RSV=sum(fossil_gas_RSV,na.rm=TRUE)/first(fossil_gas_RSV_total),\n            fossil_oil_RSV=sum(fossil_oil_RSV,na.rm=TRUE)/first(fossil_oil_RSV_total))\n\n\ngather(risk_summary,key,value,-countries,-cluster,-pop,-co2_terr_GCB) %>%\n  filter(!is.na(cluster)) %>% \n  ggplot(.,aes(x=key,y=value,fill=cluster)) +\n  geom_bar(stat='identity') +\n  facet_grid(.~cluster) +\n  theme(axis.text.x = element_text(angle = 90, hjust = 1,vjust=0.35)) +\n  theme(legend.position = \"none\",axis.title = element_blank())\n\n\n\n```\n",
    "created" : 1534337045665.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "512995011",
    "id" : "5663B785",
    "lastKnownWriteTime" : 1540827620,
    "last_content_update" : 1540827620789,
    "path" : "C:/Users/lamw/Google Drive/Work/Publications/Transition challenges/Mapping.Rmd",
    "project_path" : "Mapping.Rmd",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 1,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_markdown"
}
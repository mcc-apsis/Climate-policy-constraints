"0","risks <- pe %>% "
"0","  select(Country,ISO,Year,co2_terr_GCB,committed_coal_planned,infra_access,"
"0","         fossil_coal_hard_RSV,fossil_coal_lignite_RSV,fossil_gas_RSV,fossil_oil_RSV,pop_UN) %>% "
"0","  group_by(Country) %>% "
"0","  mutate_all(funs(na.locf(.,na.rm=FALSE))) %>% "
"0","  ungroup() %>% "
"0","  filter(Year==2015) %>% "
"0","  filter(Country!=""World"")"
"0","risks <- left_join(risks,pc %>% select(ISO,cluster),by=c(""ISO""=""ISO""))"
"0","risks <- risks %>%"
"0","  mutate_at(vars(-Country,-ISO,-Year,-cluster),funs(total=sum(.)),na.rm=TRUE)"
"0","risk_summary <- risks %>% "
"0","  group_by(cluster) %>% "
"0","  summarise(countries=paste(Country, collapse="",""),"
"0","            pop=sum(pop_UN,na.rm=TRUE)/pe$pop_UN[pe$Country==""World"" & pe$Year==2015][1],"
"0","            co2_terr_GCB=sum(co2_terr_GCB,na.rm=TRUE)/pe$co2_terr_GCB[pe$Country==""World"" & pe$Year==2015][1],"
"0","            committed_coal_planned=sum(committed_coal_planned,na.rm=TRUE)/first(committed_coal_planned_total),"
"0","            fossil_coal_hard_RSV=sum(fossil_coal_hard_RSV,na.rm=TRUE)/first(fossil_coal_hard_RSV_total),"
"0","            fossil_coal_lignite_RSV=sum(fossil_coal_lignite_RSV,na.rm=TRUE)/first(fossil_coal_lignite_RSV_total),"
"0","            fossil_gas_RSV=sum(fossil_gas_RSV,na.rm=TRUE)/first(fossil_gas_RSV_total),"
"0","            fossil_oil_RSV=sum(fossil_oil_RSV,na.rm=TRUE)/first(fossil_oil_RSV_total))"
"0","gather(risk_summary,key,value,-countries,-cluster,-pop,-co2_terr_GCB) %>%"
"0","  filter(!is.na(cluster)) %>% "
"0","  ggplot(.,aes(x=key,y=value,fill=cluster)) +"
"0","  geom_bar(stat='identity') +"
"0","  facet_grid(.~cluster) +"
"0","  theme(axis.text.x = element_text(angle = 90, hjust = 1,vjust=0.35)) +"
"0","  theme(legend.position = ""none"",axis.title = element_blank())"

"0","rm(list=ls())"
"0","library(tidyverse)"
"2","-- Attaching packages ----------------------------------------------- tidyverse 1.2.1 --
"
"2","v ggplot2 3.0.0     v purrr   0.2.5
v tibble  1.4.2     v dplyr   0.7.6
v tidyr   0.8.1     v stringr 1.3.1
v readr   1.1.1     v forcats 0.3.0
"
"2","-- Conflicts -------------------------------------------------- tidyverse_conflicts() --
x dplyr::filter() masks stats::filter()
x dplyr::lag()    masks stats::lag()
"
"0","library(gridExtra)"
"2","
Attache Paket: ‘gridExtra’

"
"2","The following object is masked from ‘package:dplyr’:

    combine

"
"0","library(xlsx)"
"0","library(zoo)"
"2","
Attache Paket: ‘zoo’

"
"2","The following objects are masked from ‘package:base’:

    as.Date, as.Date.numeric

"
"0","library(classInt)"
"2","Lade nötiges Paket: spData
"
"2","To access larger datasets in this package, install the spDataLarge package
with: `install.packages('spDataLarge',
repos='https://nowosad.github.io/drat/', type='source'))`
"
"0","library(scales)"
"2","
Attache Paket: ‘scales’

"
"2","The following object is masked from ‘package:purrr’:

    discard

"
"2","The following object is masked from ‘package:readr’:

    col_factor

"
"0","library(GGally)"
"2","
Attache Paket: ‘GGally’

"
"2","The following object is masked from ‘package:dplyr’:

    nasa

"
"0","library(ggfortify)"
"0","library(knitr)"
"0","library(kableExtra)"
"0","library(grid)"
"0","load('Data/pe.RData')"
"0","############### join SWIID ###############"
"0","load('C:\\Users\\lamw\\Google Drive\\Work\\Code\\R\\Database\\SWIID\\SWIID.RData')"
"0","pe <- left_join(pe,swiid_summary %>% select(ISO,year,gini_disp),by=c(""ISO""=""ISO"",""Year""=""year""))"
"2","Column `ISO` joining factors with different levels, coercing to character vector"
"0","rm(swiid_summary)"
"0","############### join regional values surveys ###############"
"0","load('Data/RVS.RData')"
"0","pe <- left_join(pe,RVS %>% select(ISO,Year,trust),by=c(""ISO""=""ISO"",""Year""=""Year""))"
"2","Column `ISO` joining character vector and factor, coercing into character vector"
"0","rm(RVS)"
"0","############### prepare map ###############"
"0","library(ggmap)"
"2","Google Maps API Terms of Service: http://developers.google.com/maps/terms.
"
"2","Please cite ggmap if you use it: see citation('ggmap') for details.
"
"0","library(maps)"
"2","
Attache Paket: ‘maps’

"
"2","The following object is masked from ‘package:purrr’:

    map

"
"0","library(mapdata)"
"0","world <- map_data(""world"") %>%"
"0","  filter(region != ""Antarctica"") %>%"
"0","  mutate(region=tolower(region))"
"0","isos <- read.xlsx(file=""C:\\Users\\lamw\\Google Drive\\Work\\Code\\MATLAB\\Handy code\\ISOcodes.xls"",sheetName=""3 letter codes"",startRow = 3,colIndex=7:8,header=FALSE)"
"0","names(isos) = c(""country"",""iso"")"
"0","isos <- isos %>% mutate(country=tolower(country))"
"0","world <- left_join(world,isos,by=c(""region""=""country""))"
"0","rm(isos)"
"0","############### prepare data ###############"
"0","### sum coal and lignite production, bring to latest year"
"0","pe <- pe %>% "
"0","  group_by(Country) %>% "
"0","  mutate(fossil_coal_hard_production=na.locf(fossil_coal_hard_production,na.rm=FALSE)) %>% "
"0","  mutate(fossil_coal_lignite_production=na.locf(fossil_coal_lignite_production,na.rm=FALSE)) %>% "
"0","  mutate(fossil_coal_hard_RSV=na.locf(fossil_coal_hard_RSV,na.rm=FALSE)) %>% "
"0","  mutate(fossil_coal_lignite_RSV=na.locf(fossil_coal_lignite_RSV,na.rm=FALSE)) %>% "
"0","  group_by(Country,Year) %>% "
"0","  mutate(coal_production=sum(fossil_coal_hard_production,fossil_coal_lignite_production,na.rm = TRUE)) %>% "
"0","  mutate(coal_reserves=sum(fossil_coal_lignite_RSV,fossil_coal_hard_RSV,na.rm=TRUE)) %>% "
"0","  mutate(coal_production=ifelse(coal_production==0,NA,coal_production)) %>% "
"0","  mutate(coal_reserves=ifelse(coal_reserves==0,NA,coal_reserves))"
"0","  "
"0","### sum infrastructure access, bring to latest year"
"0","pe <- pe %>% "
"0","  group_by(Country) %>% "
"0","  mutate(infra_elec_WB=na.locf(infra_elec_WB,na.rm=FALSE)) %>% "
"0","  mutate(infra_water_WB=na.locf(infra_water_WB,na.rm=FALSE)) %>% "
"0","  mutate(infra_sanitation_WB=na.locf(infra_sanitation_WB,na.rm=FALSE)) %>% "
"0","  group_by(Country,Year) %>% "
"0","  mutate(infra_access=mean(c(infra_elec_WB,infra_water_WB,infra_sanitation_WB)))"
"0","  "
"0","### elec shares"
"0","pe <- pe %>% "
"0","  group_by(Country) %>% "
"0","  mutate(ene_share_coal=ene_coal_tpes_IEA/ene_tot_tpes_IEA) %>% "
"0","  mutate(ene_share_gas=ene_gas_tpes_IEA/ene_tot_tpes_IEA) %>% "
"0","  mutate(ene_share_oil=ene_oil_tfec_IEA/ene_tot_tfec_IEA)"
"0","pe <- pe %>% "
"0","  group_by(Country) %>% "
"0","  mutate(gdp_ppp_pc=gdp_ppp_WB/pop_UN) %>% "
"0","  mutate(co2_terr_pc=co2_terr_GCB/pop_UN)"

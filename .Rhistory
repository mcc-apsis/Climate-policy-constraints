scale_fill_gradient(na.value = 'grey',high = "#132B43", low = "#56B1F7") +
theme(legend.position="bottom")
rm(z)
plot(plmaps[[i]])
}
blarg <- gather(mapdata,key,value,risk$vars)
blarg %>%
ggplot(.,aes(x=long,y=lat,group = paste(region,group),fill=value)) +
geom_polygon(color="white") +
facet_wrap(key ~.)+
theme_minimal() +
theme(axis.title = element_blank(),axis.text = element_blank(),panel.border = element_rect(color='grey',fill='NA')) +
xlim(-180,180)
#do.call(grid.arrange,c(plmaps,ncol=1))
summary_vars <- gather(ch,key,value,risk$vars) %>%
group_by(key) %>%
summarise_at("value",funs(n=sum(!is.na(.)),mean=mean(.),min=min(.),max=max(.)),na.rm=TRUE)
#summary_vars$mean[1] <- format(summary_vars$mean[1],digits=3,scientific=FALSE)
kable(summary_vars, format = "html", caption="Summary statistics",digits=1) %>%
kable_styling()
rm(plmaps,summary_vars)
mapdata <- left_join(world,ch,by=c("iso"="ISO"))
# reverse direction of WGI indicators, for interpretability
mapdata <- mapdata %>%
mutate(corruption_public_vdem=-corruption_public_vdem) %>%
mutate(democracy_electoral_vdem=-democracy_electoral_vdem)
plmaps <- list()
for(i in 1:length(risk$vars)) {
z <-  paste0("paste(", paste0('', c("region", "group"), collapse = ", "), ")")
plmaps[[i]] <- mapdata %>%
ggplot(.,aes_string("long","lat",group=z,fill=risk$vars[[i]])) +
geom_polygon(color="white") +
theme_minimal() +
theme(axis.title = element_blank(),axis.text = element_blank(),panel.border = element_rect(color='grey',fill='NA')) +
xlim(-180,180) +
coord_fixed(1) +
scale_fill_gradient(na.value = 'grey',high = "#132B43", low = "#56B1F7") +
theme(legend.position="bottom")
rm(z)
plot(plmaps[[i]])
}
#blarg <- gather(mapdata,key,value,risk$vars)
#blarg %>%
#  ggplot(.,aes(x=long,y=lat,group = paste(region,group),fill=value)) +
#  geom_polygon(color="white") +
#  facet_wrap(key ~.)+
#  theme_minimal() +
#  theme(axis.title = element_blank(),axis.text = element_blank(),panel.border = element_rect(color='grey',fill='NA')) +
#  xlim(-180,180)
#do.call(grid.arrange,c(plmaps,ncol=1))
summary_vars <- gather(ch,key,value,risk$vars) %>%
group_by(key) %>%
summarise_at("value",funs(n=sum(!is.na(.)),mean=mean(.),min=min(.),max=max(.)),na.rm=TRUE)
#summary_vars$mean[1] <- format(summary_vars$mean[1],digits=3,scientific=FALSE)
kable(summary_vars, format = "html", caption="Summary statistics",digits=1) %>%
kable_styling()
rm(plmaps,summary_vars)
##### select variables
vars <- c("rrents_oilgas_WB","ene_share_coal","democracy_electoral_vdem","corruption_public_vdem","trust")
group <- c("interests","interests","institutions","institutions","ideas","ideas")
risk <- cbind(as.data.frame(vars),group) %>%
mutate(vars=as.character(vars))
##### select variables
vars <- c("rrents_oilgas_WB","ene_share_coal","democracy_electoral_vdem","corruption_public_vdem","trust")
group <- c("interests","interests","institutions","institutions","ideas")
risk <- cbind(as.data.frame(vars),group) %>%
mutate(vars=as.character(vars))
ch <- pe %>%
select(c("Country","ISO","Year","region_IAM10","region_RCP5",risk$vars,"pop_UN"))
rm(vars,group)
#### bring data to latest year [DO SOME CHECKS HERE] ####
ch <- ch %>%
group_by(Country) %>%
mutate_all(funs(na.locf(.,na.rm=FALSE))) %>%
ungroup() %>%
filter(Year==2015) %>%
filter(Country!="World") %>%
filter(pop_UN>1000000) %>%
select(-pop_UN)
mapdata <- left_join(world,ch,by=c("iso"="ISO"))
# reverse direction of WGI indicators, for interpretability
mapdata <- mapdata %>%
mutate(corruption_public_vdem=-corruption_public_vdem) %>%
mutate(democracy_electoral_vdem=-democracy_electoral_vdem) %>%
mutate(trust=-trust)
plmaps <- list()
for(i in 1:length(risk$vars)) {
z <-  paste0("paste(", paste0('', c("region", "group"), collapse = ", "), ")")
plmaps[[i]] <- mapdata %>%
ggplot(.,aes_string("long","lat",group=z,fill=risk$vars[[i]])) +
geom_polygon(color="white") +
theme_minimal() +
theme(axis.title = element_blank(),axis.text = element_blank(),panel.border = element_rect(color='grey',fill='NA')) +
xlim(-180,180) +
coord_fixed(1) +
scale_fill_gradient(na.value = 'grey',high = "#132B43", low = "#56B1F7") +
theme(legend.position="bottom")
rm(z)
plot(plmaps[[i]])
}
#blarg <- gather(mapdata,key,value,risk$vars)
#blarg %>%
#  ggplot(.,aes(x=long,y=lat,group = paste(region,group),fill=value)) +
#  geom_polygon(color="white") +
#  facet_wrap(key ~.)+
#  theme_minimal() +
#  theme(axis.title = element_blank(),axis.text = element_blank(),panel.border = element_rect(color='grey',fill='NA')) +
#  xlim(-180,180)
#do.call(grid.arrange,c(plmaps,ncol=1))
summary_vars <- gather(ch,key,value,risk$vars) %>%
group_by(key) %>%
summarise_at("value",funs(n=sum(!is.na(.)),mean=mean(.),min=min(.),max=max(.)),na.rm=TRUE)
#summary_vars$mean[1] <- format(summary_vars$mean[1],digits=3,scientific=FALSE)
kable(summary_vars, format = "html", caption="Summary statistics",digits=1) %>%
kable_styling()
rm(plmaps,summary_vars)
### histograms ###
gather(ch,key,value,risk$vars) %>%
ggplot(.,aes(x=value)) +
geom_histogram(bins=20) +
facet_wrap(. ~ key,scales="free") +
theme(axis.title = element_blank())
### correlation plots ###
ch %>%
# mutate(gov_effect_WGI=-gov_effect_WGI) %>%
# mutate(gov_corrupt_WGI=-gov_corrupt_WGI) %>%
select(risk$vars) %>%
ggcorr(method=c("na.or.complete","spearman"),label=TRUE,label_size=4,label_alpha=TRUE,hjust = 0.85,size = 4, color = "grey50",
layout.exp = 2)
ch %>%
select(risk$vars) %>%
ggpairs(progress = FALSE)
### heterogeneity by exogenous region
region="region_RCP5"
countries <- ch %>%
group_by_(region) %>%
summarise(countries=paste(Country, collapse=", "))
summary_regions <- ch %>%
group_by_(region) %>%
summarise_at(risk$vars,mean,na.rm=TRUE) %>%
cbind(.,countries=countries$countries) %>%
filter_at(region,any_vars(!is.na(.)))
gather(ch,key,value,risk$vars) %>%
filter_at(region,any_vars(!is.na(.))) %>%
ggplot(.,aes_string(x=region,y="value",fill=region)) +
geom_boxplot() +
facet_wrap(key ~., scales="free",switch="y",ncol=3) +
theme(axis.text.x=element_blank(),axis.title.x = element_blank(),axis.ticks.x = element_blank()) +
theme(axis.title.y = element_blank(),strip.text.y = element_text(size = 10)) +
theme(legend.position = "bottom",legend.title = element_blank()) +
guides(fill = guide_legend(nrow = 1,label.position = "bottom",keywidth = unit(1.25,"cm")))
##### transition bottlenecks
load('Data\\remind.RData')
vars = c("Emissions|CO2","Policy Cost|Consumption Loss","Policy Cost|GDP Loss","Primary Energy|Coal","Primary Energy|Gas","Primary Energy|Oil","Primary Energy|Fossil","Subsidies|Energy|Fossil","Trade|Primary Energy|Coal|Volume","Trade|Primary Energy|Gas|Volume","Trade|Primary Energy|Oil|Volume","Population");
remind <- remind %>%
filter(SCENARIO=="2C_Def") %>%
mutate(REGION=replace(REGION,REGION=="R5ASIA","ASIA")) %>%
mutate(REGION=replace(REGION,REGION=="R5LAM","LAM")) %>%
mutate(REGION=replace(REGION,REGION=="R5MAF","MAF")) %>%
mutate(REGION=replace(REGION,REGION=="R5OECD90+EU","OECD90")) %>%
mutate(REGION=replace(REGION,REGION=="R5REF","REF")) %>%
filter(VARIABLE %in% vars) %>%
select(-MODEL,-SCENARIO,-UNIT) %>%
filter(REGION!="World")
blarg <- gather(remind,year,value,'2015':'2100')
blarg <- spread(blarg,VARIABLE,value)
zz <- blarg %>%
filter(year==2020 | year==2050) %>%
group_by(REGION) %>%
mutate(CO2_reduction_rate = nth(`Emissions|CO2`,1)/nth(`Emissions|CO2`,2))
blarg <- blarg %>%
group_by(REGION) %>%
summarise(consumption_loss=sum(`Policy Cost|Consumption Loss`)/sum(`Population`),
GDP_cost = sum(`Policy Cost|GDP Loss`)/sum(`Population`))
rm(countries,summary_regions,vars)
library(cluster)
pc <- ch %>%
filter_at(vars(risk$vars),all_vars(!is.na(.))) %>%
column_to_rownames(var = "Country")
comps <- prcomp(pc %>% select(risk$vars),scale.=TRUE) # calculate principal components; Choose whether to scale
screeplot(comps, type="lines",col=3)
summary_pca <- rbind(
SD = sqrt(comps$sdev^2),
Proportion = comps$sdev^2/sum(comps$sdev^2),
Cumulative = cumsum(comps$sdev^2 / sum(comps$sdev^2))
) %>%
rbind(.,comps$rotation)
kable(summary_pca, format = "html", caption="PCA analysis",digits=2) %>%
kable_styling()
d_dist <- dist(as.matrix(comps$x[,1:4])) ### look at heirarchical clusters
plot(hclust(d_dist))
######### scree plot
mydata <- comps$x[,1:3]
wss <- (nrow(mydata)-1)*sum(apply(mydata,2,var))
for (i in 2:15) wss[i] <- sum(kmeans(mydata,
centers=i)$withinss)
plot(1:15, wss, type="b", xlab="Number of Clusters",
ylab="Within groups sum of squares")
# clusters <- kmeans(comps$x[,1:3],5); ### choose no. clusters & no. PCs
# pc <- cbind(pc,cluster=clusters$cluster) ### bind clusters to dataset
# pc$cluster <- as.factor(clusters$cluster) ### convert to factor
clusters <- pam(comps$x[,1:4],6)
pc <- cbind(pc,cluster=clusters$cluster) ### bind clusters to dataset
pc$cluster <- as.factor(clusters$cluster) ### convert to factor
library(cluster)
pc <- ch %>%
filter_at(vars(risk$vars),all_vars(!is.na(.))) %>%
column_to_rownames(var = "Country")
comps <- prcomp(pc %>% select(risk$vars),scale.=TRUE) # calculate principal components; Choose whether to scale
screeplot(comps, type="lines",col=3)
summary_pca <- rbind(
SD = sqrt(comps$sdev^2),
Proportion = comps$sdev^2/sum(comps$sdev^2),
Cumulative = cumsum(comps$sdev^2 / sum(comps$sdev^2))
) %>%
rbind(.,comps$rotation)
kable(summary_pca, format = "html", caption="PCA analysis",digits=2) %>%
kable_styling()
d_dist <- dist(as.matrix(comps$x[,1:4])) ### look at heirarchical clusters
plot(hclust(d_dist))
######### scree plot
mydata <- comps$x[,1:3]
wss <- (nrow(mydata)-1)*sum(apply(mydata,2,var))
for (i in 2:15) wss[i] <- sum(kmeans(mydata,
centers=i)$withinss)
plot(1:15, wss, type="b", xlab="Number of Clusters",
ylab="Within groups sum of squares")
# clusters <- kmeans(comps$x[,1:3],5); ### choose no. clusters & no. PCs
# pc <- cbind(pc,cluster=clusters$cluster) ### bind clusters to dataset
# pc$cluster <- as.factor(clusters$cluster) ### convert to factor
clusters <- pam(comps$x[,1:3],5)
pc <- cbind(pc,cluster=clusters$cluster) ### bind clusters to dataset
pc$cluster <- as.factor(clusters$cluster) ### convert to factor
autoplot(comps,loadings=TRUE,loadings.label=TRUE,data=pc,label=TRUE,colour='cluster')
mapdata <- left_join(world,pc,by=c("iso"="ISO"))
mapdata %>%
ggplot(.) +
geom_polygon(aes(long,lat,group = paste(region,group),fill=cluster),color="white") +
theme_void() +
coord_fixed(1) +
scale_fill_discrete() +
labs(title="Typology")
tt <- pe %>%
select(c("Country","ISO","Year","region_IAM10","region_RCP5",risk$vars,"pop_UN")) %>%
filter(Country!="World")
#1996 - 2000 average
#2010 - 2014 average
tt <- left_join(tt,pc %>% rownames_to_column(var="Country") %>% select(Country,cluster),by=("Country"="Country"))
tt <- tt %>%
group_by(Country,region_RCP5,cluster) %>%
filter(!is.na(region_RCP5)) %>%
mutate(gov_corrup_90s=mean(gov_corrupt_WGI[which(Year>=1996 & Year<=2000)]),
gov_corrup_10s=mean(gov_corrupt_WGI[which(Year>=2010 & Year<=2014)]),
gov_effect_90s=mean(gov_corrupt_WGI[which(Year>=1996 & Year<=2000)]),
gov_effect_10s=mean(gov_corrupt_WGI[which(Year>=2010 & Year<=2014)]),
econ_rrents_90s=mean(rrents_oilgas_WB[which(Year>=1995 & Year<=2000)]),
econ_rrents_10s=mean(rrents_oilgas_WB[which(Year>=2010 & Year<=2014)]),
coal_90s=mean(ene_share_coal[which(Year>=1995 & Year <=2000)]),
coal_10s=mean(ene_share_coal[which(Year>=2010 & Year <=2013)]))
tt <- tt %>%
group_by(Country,region_RCP5,cluster) %>%
filter(!is.na(region_RCP5)) %>%
mutate(
gov_corrup_90s=mean(corruption_public_vdem[which(Year>=1996 & Year<=2000)]),
gov_corrup_10s=mean(corruption_public_vdem[which(Year>=2010 & Year<=2014)]),
democracy_90s=mean(democracy_electoral_vdem[which(Year>=1996 & Year<=2000)]),
democracy_10s=mean(democracy_electoral_vdem[which(Year>=2010 & Year<=2014)]),
oilgas_rrents_90s=mean(rrents_oilgas_WB[which(Year>=1995 & Year<=2000)]),
oilgas_rrents_10s=mean(rrents_oilgas_WB[which(Year>=2010 & Year<=2014)]),
coal_90s=mean(ene_share_coal[which(Year>=1995 & Year <=2000)]),
coal_10s=mean(ene_share_coal[which(Year>=2010 & Year <=2013)]),
trust_90s=mean(trust[which(Year>=1995 & Year <=2000)]),
trust_10s=mean(trust[which(Year>=2010 & Year <=2015)])
)
plots <- list()
plots[[1]] <- tt %>%
ggplot(.,aes(x=gov_corrup_90s,y=gov_corrup_10s,fill=cluster,size=pop_UN)) +
geom_point(pch=21,stroke=0.5,colour="#636363") +
scale_size_continuous(range = c(1,10)) +
geom_abline(intercept=0,slope=1) +
xlim(-2,2) +
ylim(-2,2) +
theme(legend.position="none")
plots[[2]] <- tt %>%
ggplot(.,aes(x=democracy_90s,y=democracy_10s,fill=cluster,size=pop_UN)) +
geom_point(pch=21,stroke=0.5,colour="#636363") +
scale_size_continuous(range = c(1,10)) +
geom_abline(intercept=0,slope=1) +
xlim(-2,2) +
ylim(-2,2) +
theme(legend.position="none")
plots[[3]] <- tt %>%
ggplot(.,aes(x=oilgas_rrents_90s,y=oilgas_rrents_10s,fill=cluster,size=pop_UN)) +
geom_point(pch=21,stroke=0.5,colour="#636363") +
scale_size_continuous(range = c(1,10)) +
geom_abline(intercept=0,slope=1) +
theme(legend.position="none") +
xlim(0,60)+
ylim(0,60)
plots[[4]] <- tt %>%
ggplot(.,aes(x=coal_90s,y=coal_10s,fill=cluster,size=pop_UN)) +
geom_point(pch=21,stroke=0.5,colour="#636363") +
scale_size_continuous(range = c(1,10)) +
geom_abline(intercept=0,slope=1) +
theme(legend.position="none")
plots[[5]] <- tt %>%
ggplot(.,aes(x=trust_90s,y=trust_10s,fill=cluster,size=pop_UN)) +
geom_point(pch=21,stroke=0.5,colour="#636363") +
scale_size_continuous(range = c(1,10)) +
geom_abline(intercept=0,slope=1) +
theme(legend.position="none")
do.call(grid.arrange,c(plots,ncol=2))
plots[[1]] <- tt %>%
ggplot(.,aes(x=gov_corrup_90s,y=gov_corrup_10s,fill=cluster,size=pop_UN)) +
geom_point(pch=21,stroke=0.5,colour="#636363") +
scale_size_continuous(range = c(1,10)) +
geom_abline(intercept=0,slope=1) +
#xlim(-2,2) +
#ylim(-2,2) +
theme(legend.position="none")
tt <- pe %>%
select(c("Country","ISO","Year","region_IAM10","region_RCP5",risk$vars,"pop_UN")) %>%
filter(Country!="World")
#1996 - 2000 average
#2010 - 2014 average
tt <- left_join(tt,pc %>% rownames_to_column(var="Country") %>% select(Country,cluster),by=("Country"="Country"))
tt <- tt %>%
group_by(Country,region_RCP5,cluster) %>%
filter(!is.na(region_RCP5)) %>%
mutate(
gov_corrup_90s=mean(corruption_public_vdem[which(Year>=1996 & Year<=2000)]),
gov_corrup_10s=mean(corruption_public_vdem[which(Year>=2010 & Year<=2014)]),
democracy_90s=mean(democracy_electoral_vdem[which(Year>=1996 & Year<=2000)]),
democracy_10s=mean(democracy_electoral_vdem[which(Year>=2010 & Year<=2014)]),
oilgas_rrents_90s=mean(rrents_oilgas_WB[which(Year>=1995 & Year<=2000)]),
oilgas_rrents_10s=mean(rrents_oilgas_WB[which(Year>=2010 & Year<=2014)]),
coal_90s=mean(ene_share_coal[which(Year>=1995 & Year <=2000)]),
coal_10s=mean(ene_share_coal[which(Year>=2010 & Year <=2013)]),
trust_90s=mean(trust[which(Year>=1995 & Year <=2000)]),
trust_10s=mean(trust[which(Year>=2010 & Year <=2015)])
)
plots <- list()
plots[[1]] <- tt %>%
ggplot(.,aes(x=gov_corrup_90s,y=gov_corrup_10s,fill=cluster,size=pop_UN)) +
geom_point(pch=21,stroke=0.5,colour="#636363") +
scale_size_continuous(range = c(1,10)) +
geom_abline(intercept=0,slope=1) +
#xlim(-2,2) +
#ylim(-2,2) +
theme(legend.position="none")
plots[[2]] <- tt %>%
ggplot(.,aes(x=democracy_90s,y=democracy_10s,fill=cluster,size=pop_UN)) +
geom_point(pch=21,stroke=0.5,colour="#636363") +
scale_size_continuous(range = c(1,10)) +
geom_abline(intercept=0,slope=1) +
#xlim(-2,2) +
#ylim(-2,2) +
theme(legend.position="none")
plots[[3]] <- tt %>%
ggplot(.,aes(x=oilgas_rrents_90s,y=oilgas_rrents_10s,fill=cluster,size=pop_UN)) +
geom_point(pch=21,stroke=0.5,colour="#636363") +
scale_size_continuous(range = c(1,10)) +
geom_abline(intercept=0,slope=1) +
theme(legend.position="none") +
xlim(0,60)+
ylim(0,60)
plots[[4]] <- tt %>%
ggplot(.,aes(x=coal_90s,y=coal_10s,fill=cluster,size=pop_UN)) +
geom_point(pch=21,stroke=0.5,colour="#636363") +
scale_size_continuous(range = c(1,10)) +
geom_abline(intercept=0,slope=1) +
theme(legend.position="none")
plots[[5]] <- tt %>%
ggplot(.,aes(x=trust_90s,y=trust_10s,fill=cluster,size=pop_UN)) +
geom_point(pch=21,stroke=0.5,colour="#636363") +
scale_size_continuous(range = c(1,10)) +
geom_abline(intercept=0,slope=1) +
theme(legend.position="none")
do.call(grid.arrange,c(plots,ncol=2))
#rm(plots,tt)
blarg <- pe %>% select(Country,Year,trust)
View(blarg)
tt <- pe %>%
select(c("Country","ISO","Year","region_IAM10","region_RCP5",risk$vars,"pop_UN")) %>%
filter(Country!="World")
#1996 - 2000 average
#2010 - 2014 average
tt <- left_join(tt,pc %>% rownames_to_column(var="Country") %>% select(Country,cluster),by=("Country"="Country"))
tt <- tt %>%
group_by(Country,region_RCP5,cluster) %>%
filter(!is.na(region_RCP5)) %>%
mutate(
gov_corrup_90s=mean(corruption_public_vdem[which(Year>=1996 & Year<=2000)]),
gov_corrup_10s=mean(corruption_public_vdem[which(Year>=2010 & Year<=2014)]),
democracy_90s=mean(democracy_electoral_vdem[which(Year>=1996 & Year<=2000)]),
democracy_10s=mean(democracy_electoral_vdem[which(Year>=2010 & Year<=2014)]),
oilgas_rrents_90s=mean(rrents_oilgas_WB[which(Year>=1995 & Year<=2000)]),
oilgas_rrents_10s=mean(rrents_oilgas_WB[which(Year>=2010 & Year<=2014)]),
coal_90s=mean(ene_share_coal[which(Year>=1995 & Year <=2000)]),
coal_10s=mean(ene_share_coal[which(Year>=2010 & Year <=2013)]))
plots <- list()
plots[[1]] <- tt %>%
ggplot(.,aes(x=gov_corrup_90s,y=gov_corrup_10s,fill=cluster,size=pop_UN)) +
geom_point(pch=21,stroke=0.5,colour="#636363") +
scale_size_continuous(range = c(1,10)) +
geom_abline(intercept=0,slope=1) +
#xlim(-2,2) +
#ylim(-2,2) +
theme(legend.position="none")
plots[[2]] <- tt %>%
ggplot(.,aes(x=democracy_90s,y=democracy_10s,fill=cluster,size=pop_UN)) +
geom_point(pch=21,stroke=0.5,colour="#636363") +
scale_size_continuous(range = c(1,10)) +
geom_abline(intercept=0,slope=1) +
#xlim(-2,2) +
#ylim(-2,2) +
theme(legend.position="none")
plots[[3]] <- tt %>%
ggplot(.,aes(x=oilgas_rrents_90s,y=oilgas_rrents_10s,fill=cluster,size=pop_UN)) +
geom_point(pch=21,stroke=0.5,colour="#636363") +
scale_size_continuous(range = c(1,10)) +
geom_abline(intercept=0,slope=1) +
theme(legend.position="none") +
xlim(0,60)+
ylim(0,60)
plots[[4]] <- tt %>%
ggplot(.,aes(x=coal_90s,y=coal_10s,fill=cluster,size=pop_UN)) +
geom_point(pch=21,stroke=0.5,colour="#636363") +
scale_size_continuous(range = c(1,10)) +
geom_abline(intercept=0,slope=1) +
theme(legend.position="none")
do.call(grid.arrange,c(plots,ncol=2))
#rm(plots,tt)
plots[[2]] <- tt %>%
ggplot(.,aes(x=democracy_90s,y=democracy_10s,fill=cluster,size=pop_UN)) +
geom_point(pch=21,stroke=0.5,colour="#636363") +
scale_size_continuous(range = c(1,10)) +
geom_abline(intercept=0,slope=1) +
xlim(0,1) +
ylim(0,1) +
theme(legend.position="none")
do.call(grid.arrange,c(plots,ncol=2))
countries <- pc %>%
rownames_to_column(var="Country") %>%
group_by(cluster) %>%
summarise(countries=paste(Country, collapse=", "))
cluster_summary <- pc %>%
rownames_to_column(var="Country") %>%
group_by(cluster) %>%
summarise_at(vars(risk$vars),mean) %>%
cbind(.,countries=countries$countries) %>%
select(cluster,countries,everything()) %>%
mutate(countries=as.character(countries))
cluster_summary <- cbind(cluster_summary,mediods=rownames(clusters$medoids)) %>%
select(cluster,mediods,countries,everything()) %>%
mutate_at(risk$vars,funs(round(.,2)))
kable(t(cluster_summary), format = "html", caption="blarg",digits=1) %>%
kable_styling() %>%
scroll_box(height = "800px")
###facet grid the trends
# cluster_trend <- pe %>%
#   select(Country,ISO,Year,risk$vars)
# cluster_trend <- left_join(cluster_trend,pc %>% select(ISO,cluster),by=c("ISO"="ISO")) %>%
#   filter(Year>1990) %>%
#   filter(!is.na(cluster)) %>%
#   group_by(cluster,Year) %>%
#   summarise_at(risk$vars,mean,na.rm=TRUE)
#
# cluster_trend <- gather(cluster_trend,key,value,risk$vars)
# cluster_trend %>%
#   ggplot(.,aes(x=Year,y=value,color=cluster)) +
#   geom_line(size=1) +
#   facet_grid(key ~ cluster,scales="free",switch="y") +
#   theme(legend.position = "none") +
#   theme(axis.title=element_blank()) +
#   scale_x_continuous(breaks=c(1990,2000,2010))
risks <- pe %>%
select(Country,ISO,Year,co2_terr_GCB,committed_coal_planned,infra_access,
fossil_coal_hard_RSV,fossil_coal_lignite_RSV,fossil_gas_RSV,fossil_oil_RSV,pop_UN) %>%
group_by(Country) %>%
mutate_all(funs(na.locf(.,na.rm=FALSE))) %>%
ungroup() %>%
filter(Year==2015) %>%
filter(Country!="World")
risks <- pe %>%
select(Country,ISO,Year,co2_terr_GCB,committed_coal_planned,
fossil_coal_hard_RSV,fossil_coal_lignite_RSV,fossil_gas_RSV,fossil_oil_RSV,pop_UN) %>%
group_by(Country) %>%
mutate_all(funs(na.locf(.,na.rm=FALSE))) %>%
ungroup() %>%
filter(Year==2015) %>%
filter(Country!="World")
risks <- left_join(risks,pc %>% select(ISO,cluster),by=c("ISO"="ISO"))
risks <- risks %>%
mutate_at(vars(-Country,-ISO,-Year,-cluster),funs(total=sum(.)),na.rm=TRUE)
risk_summary <- risks %>%
group_by(cluster) %>%
summarise(countries=paste(Country, collapse=","),
pop=sum(pop_UN,na.rm=TRUE)/pe$pop_UN[pe$Country=="World" & pe$Year==2015][1],
co2_terr_GCB=sum(co2_terr_GCB,na.rm=TRUE)/pe$co2_terr_GCB[pe$Country=="World" & pe$Year==2015][1],
committed_coal_planned=sum(committed_coal_planned,na.rm=TRUE)/first(committed_coal_planned_total),
fossil_coal_hard_RSV=sum(fossil_coal_hard_RSV,na.rm=TRUE)/first(fossil_coal_hard_RSV_total),
fossil_coal_lignite_RSV=sum(fossil_coal_lignite_RSV,na.rm=TRUE)/first(fossil_coal_lignite_RSV_total),
fossil_gas_RSV=sum(fossil_gas_RSV,na.rm=TRUE)/first(fossil_gas_RSV_total),
fossil_oil_RSV=sum(fossil_oil_RSV,na.rm=TRUE)/first(fossil_oil_RSV_total))
gather(risk_summary,key,value,-countries,-cluster,-pop,-co2_terr_GCB) %>%
filter(!is.na(cluster)) %>%
ggplot(.,aes(x=key,y=value,fill=cluster)) +
geom_bar(stat='identity') +
facet_grid(.~cluster) +
theme(axis.text.x = element_text(angle = 90, hjust = 1,vjust=0.35)) +
theme(legend.position = "none",axis.title = element_blank())

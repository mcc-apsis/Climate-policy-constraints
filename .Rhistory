kable_styling()
#d_dist <- dist(as.matrix(comps$x[,1:4])) ### look at heirarchical clusters
#plot(hclust(d_dist))
######### scree plot
scree_data <- comps$x[,1:4]
wss <- (nrow(scree_data)-1)*sum(apply(scree_data,2,var))
for (i in 2:15) wss[i] <- sum(kmeans(scree_data,
centers=i)$withinss)
plot(1:15, wss, type="b", xlab="Number of Clusters",
ylab="Within groups sum of squares")
# clusters <- kmeans(comps$x[,1:3],5); ### choose no. clusters & no. PCs
# pc <- cbind(pc,cluster=clusters$cluster) ### bind clusters to dataset
# pc$cluster <- as.factor(clusters$cluster) ### convert to factor
clusters <- pam(comps$x[,1:5],5)
pc <- cbind(pc,cluster=clusters$cluster) ### bind clusters to dataset
pc$cluster <- as.factor(clusters$cluster) ### convert to factor
rm(clusters,i,wss)
rm(scree_data,summary_pca)
autoplot(comps,loadings=TRUE,loadings.label=TRUE,data=pc,label=TRUE,colour='cluster')
mapdata <- left_join(world,pc %>% select(ISO,cluster),by=c("iso"="ISO"))
mapdata %>%
ggplot(.) +
geom_polygon(aes(long,lat,group = paste(region,group),fill=cluster),color="white") +
theme_void() +
coord_fixed(1) +
scale_fill_discrete() +
labs(title="Typology")
pc <- left_join(pc,pe %>% filter(Year==2017) %>% select(ISO,co2_terr_GCB),by=("ISO"="ISO"))
library(tidyverse)
pc <- left_join(pc,pe %>% filter(Year==2017) %>% select(ISO,co2_terr_GCB),by=("ISO"="ISO"))
world <- pe %>% filter(Year==2017,ISO=="WLD") %>% select(co2_terr_GCB,pop_UN)
blarg <- pc %>%
group_by(cluster) %>%
summarise(co2=sum(co2_terr_GCB),pop=sum(pop_UN),countries=paste(Country,collapse="; ")) %>%
mutate(co2_frac=co2/world$co2_terr_GCB[[1]],pop_frac=pop/world$pop_UN[[1]])
openxlsx::write.xlsx(blarg,"Results/results.xlsx",sheetName="cluster_description",row.names=F)
View(blarg)
pc <- left_join(pc,pe %>% filter(Year==2017) %>% select(ISO,co2_terr_GCB),by=("ISO"="ISO"))
world <- pe %>% filter(Year==2017,ISO=="WLD") %>% select(co2_terr_GCB,pop_UN)
blarg <- pc %>%
group_by(cluster) %>%
summarise(co2=sum(co2_terr_GCB),pop=sum(pop_UN),countries=paste(Country,collapse="; ")) %>%
mutate(co2_frac=co2/world$co2_terr_GCB[[1]],pop_frac=pop/world$pop_UN[[1]])
pc <- left_join(pc,pe %>% filter(Year==2017) %>% select(ISO,co2_terr_GCB),by=("ISO"="ISO"))
world <- pe %>% filter(Year==2017,ISO=="WLD") %>% select(co2_terr_GCB,pop_UN)
blarg <- pc %>%
group_by(cluster) %>%
summarise(co2=sum(co2_terr_GCB),pop=sum(pop_UN),countries=paste(Country,collapse="; ")) %>%
mutate(co2_frac=co2/world$co2_terr_GCB[[1]],pop_frac=pop/world$pop_UN[[1]])
openxlsx::write.xlsx(blarg,"Results/results.xlsx",sheetName="cluster_description",row.names=F)
View(world)
rm(list=ls())
library(tidyverse)
library(gridExtra)
library(xlsx)
library(zoo)
library(classInt)
library(scales)
library(GGally)
library(ggfortify)
library(knitr)
library(kableExtra)
library(grid)
library(ggplot2); theme_set(theme_bw())
load('Data/pe.RData')
############### prepare map ###############
library(ggmap)
library(maps)
library(mapdata)
world <- map_data("world") %>%
filter(region != "Antarctica") %>%
mutate(region=tolower(region))
isos <- read.xlsx(file="C:/Users/lamw/Documents/SpiderOak Hive/Work/Code/R/.Place names and codes/output/ISOcodes.xlsx",sheetName="alternative_names",header=TRUE)
names(isos) = c("country","iso")
world <- left_join(world,isos %>% mutate(country=tolower(country)),by=c("region"="country"))
rm(isos)
############### prepare data ###############
### elec shares
pe <- pe %>%
group_by(Country) %>%
mutate(ene_share_coal=ene_coal_tpes_IEA/ene_tot_tpes_IEA) %>%
mutate(ene_share_gas=ene_gas_tpes_IEA/ene_tot_tpes_IEA) %>%
mutate(ene_share_oil=ene_oil_tfec_IEA/ene_tot_tfec_IEA)
### GDP per capita
pe <- pe %>%
group_by(Country) %>%
mutate(gdp_ppp_pc=gdp_ppp_WB/pop_UN) %>%
mutate(co2_terr_pc=co2_terr_GCB/pop_UN)
### subsidies per gdp
pe <- pe %>%
group_by(Country) %>%
mutate(subsidy_pretax_IMF_gdp = subsidy_pretax_IMF/gdp_real_WB) %>%
mutate(subsidy_posttax_IMF_gdp = subsidy_posttax_IMF/gdp_real_WB)
### sum oil and gas resource rents
pe <- pe %>%
group_by(Country) %>%
mutate(rrents_oilgas_WB=rrents_oil_WB+rrents_gas_WB)
p5 <- ch %>%
filter(pop_UN>1e6) %>%
top_n(-25,climate_aware) %>%
ggplot(.,aes(x=reorder(Country,climate_aware),y=climate_aware)) +
geom_bar(stat='identity',fill="#74a9cf") +
geom_hline(yintercept=mean(ch$climate_aware,na.rm=T),color='#525252',size=1) +
ylab("% of people who are aware of climate change)") +
coord_flip() +
geom_text(aes(x=5,y=mean(ch$climate_aware,na.rm=T)-1.35,label="World Average"),angle=90,color='#252525') +
theme(axis.title.y = element_blank())
p5 <- ch %>%
filter(pop_UN>1e6) %>%
top_n(-25,climate_aware) %>%
ggplot(.,aes(x=reorder(Country,climate_aware),y=climate_aware)) +
geom_bar(stat='identity',fill="#74a9cf") +
geom_hline(yintercept=mean(ch$climate_aware,na.rm=T),color='#525252',size=1) +
ylab("Climate awareness (% of people who are aware of climate change)") +
coord_flip() +
geom_text(aes(x=5,y=mean(ch$climate_aware,na.rm=T)-1.35,label="World Average"),angle=90,color='#252525') +
theme(axis.title.y = element_blank())
rm(list=ls())
library(tidyverse)
library(gridExtra)
library(xlsx)
library(zoo)
library(classInt)
library(scales)
library(GGally)
library(ggfortify)
library(knitr)
library(kableExtra)
library(grid)
library(ggplot2); theme_set(theme_bw())
load('Data/pe.RData')
############### prepare map ###############
library(ggmap)
library(maps)
library(mapdata)
world <- map_data("world") %>%
filter(region != "Antarctica") %>%
mutate(region=tolower(region))
isos <- read.xlsx(file="C:/Users/lamw/Documents/SpiderOak Hive/Work/Code/R/.Place names and codes/output/ISOcodes.xlsx",sheetName="alternative_names",header=TRUE)
names(isos) = c("country","iso")
world <- left_join(world,isos %>% mutate(country=tolower(country)),by=c("region"="country"))
rm(isos)
############### prepare data ###############
### elec shares
pe <- pe %>%
group_by(Country) %>%
mutate(ene_share_coal=ene_coal_tpes_IEA/ene_tot_tpes_IEA) %>%
mutate(ene_share_gas=ene_gas_tpes_IEA/ene_tot_tpes_IEA) %>%
mutate(ene_share_oil=ene_oil_tfec_IEA/ene_tot_tfec_IEA)
### GDP per capita
pe <- pe %>%
group_by(Country) %>%
mutate(gdp_ppp_pc=gdp_ppp_WB/pop_UN) %>%
mutate(co2_terr_pc=co2_terr_GCB/pop_UN)
### subsidies per gdp
pe <- pe %>%
group_by(Country) %>%
mutate(subsidy_pretax_IMF_gdp = subsidy_pretax_IMF/gdp_real_WB) %>%
mutate(subsidy_posttax_IMF_gdp = subsidy_posttax_IMF/gdp_real_WB)
### sum oil and gas resource rents
pe <- pe %>%
group_by(Country) %>%
mutate(rrents_oilgas_WB=rrents_oil_WB+rrents_gas_WB)
##### select variables
vars <- c("co2_terr_pc","laws","subsidy_pretax_IMF_gdp","rrents_oilgas_WB","ene_share_coal","democracy_electoral_vdem","gov_corrupt_WGI","trust_last","climate_aware")
group <- c("dependent","dependent","dependent","interests","interests","institutions","institutions","ideas","ideas")
risk <- cbind(as.data.frame(vars),group) %>%
mutate(vars=as.character(vars))
ch <- pe %>%
select(c("Country","ISO","Year","pop_UN","region_IAM10","region_RCP5",risk$vars)) %>%
filter(Year>=1990)
rm(vars,group)
#### bring data to latest year [DO SOME CHECKS HERE] ####
ch <- ch %>%
group_by(Country) %>%
mutate_at(vars(-group_cols()),funs(na.locf(.,na.rm=FALSE))) %>%
ungroup() %>%
filter(Year==2017) %>%
filter(Country!="World") %>%
filter(pop_UN>1000000)
##### put carbon price gap to 1 if no data ######
# ch <- ch %>%
#   group_by(Country) %>%
#   mutate(carbon_price_gap=ifelse(is.na(carbon_price_gap),1,carbon_price_gap)) %>%
#   ungroup()
#### change the signs on the data 1 is more constrained, 0 is less
# ch <- ch %>%
#   mutate(democracy_electoral_vdem=-democracy_electoral_vdem) %>%
#   mutate(corruption_public_vdem=-corruption_public_vdem) %>%
#   mutate(trust_last=-trust_last)
#### Give nicer names
### histograms ###
gather(ch,key,value,risk$vars) %>%
ggplot(.,aes(x=value)) +
geom_histogram(bins=20) +
facet_wrap(. ~ key,scales="free") +
theme(axis.title = element_blank())
### correlation plots ###
library(ggcorrplot)
corr_data <- round(cor(ch %>% select(risk$vars),method="spearman",use="complete.obs"),2)
ggcorrplot(corr_data,type="upper",
ggtheme = ggplot2::theme_gray,
colors = c("#6D9EC1", "white", "#E46726"),lab=TRUE)
rm(corr_data)
library(cluster)
pc <- ch %>%
filter_at(vars(risk$vars),all_vars(!is.na(.))) %>%
column_to_rownames(var = "Country")
comps <- prcomp(pc %>% select(risk$vars),scale.=TRUE) # calculate principal components; Choose whether to scale
screeplot(comps, type="lines",col=3)
summary_pca <- rbind(
SD = sqrt(comps$sdev^2),
Proportion = comps$sdev^2/sum(comps$sdev^2),
Cumulative = cumsum(comps$sdev^2 / sum(comps$sdev^2))
) %>%
rbind(.,comps$rotation)
kable(summary_pca, format = "html", caption="PCA analysis",digits=2) %>%
kable_styling()
#d_dist <- dist(as.matrix(comps$x[,1:4])) ### look at heirarchical clusters
#plot(hclust(d_dist))
######### scree plot
scree_data <- comps$x[,1:5]
wss <- (nrow(scree_data)-1)*sum(apply(scree_data,2,var))
for (i in 2:15) wss[i] <- sum(kmeans(scree_data,
centers=i)$withinss)
plot(1:15, wss, type="b", xlab="Number of Clusters",
ylab="Within groups sum of squares")
# clusters <- kmeans(comps$x[,1:3],5); ### choose no. clusters & no. PCs
# pc <- cbind(pc,cluster=clusters$cluster) ### bind clusters to dataset
# pc$cluster <- as.factor(clusters$cluster) ### convert to factor
clusters <- pam(comps$x[,1:5],5)
pc <- cbind(pc,cluster=clusters$cluster) ### bind clusters to dataset
pc$cluster <- as.factor(clusters$cluster) ### convert to factor
rm(clusters,i,wss)
rm(scree_data,summary_pca)
autoplot(comps,loadings=TRUE,loadings.label=TRUE,data=pc,label=TRUE,colour='cluster')
mapdata <- left_join(world,pc %>% select(ISO,cluster),by=c("iso"="ISO"))
mapdata %>%
ggplot(.) +
geom_polygon(aes(long,lat,group = paste(region,group),fill=cluster),color="white") +
theme_void() +
coord_fixed(1) +
scale_fill_discrete() +
labs(title="Typology")
tt <- pe %>%
select(c("Country","ISO","Year","pop_UN","region_IAM10","region_RCP5",risk$vars,"trust_first")) %>%
filter(Country!="World")
#1996 - 2000 average
#2010 - 2014 average
tt <- left_join(tt,pc %>% rownames_to_column(var="Country") %>%
select(Country,cluster),by=("Country"="Country"))
tt <- tt %>%
group_by(Country,region_RCP5,cluster) %>%
filter(!is.na(region_RCP5)) %>%
mutate(
gov_corrup_90s=mean(gov_corrupt_WGI[which(Year>=1996 & Year<=2000)]),
gov_corrup_10s=mean(gov_corrupt_WGI[which(Year>=2010 & Year<=2014)]),
democracy_90s=mean(democracy_electoral_vdem[which(Year>=1995 & Year<=2000)]),
democracy_10s=mean(democracy_electoral_vdem[which(Year>=2010 & Year<=2014)]),
oilgas_rrents_90s=mean(rrents_oilgas_WB[which(Year>=1995 & Year<=2000)]),
oilgas_rrents_10s=mean(rrents_oilgas_WB[which(Year>=2010 & Year<=2014)]),
coal_90s=mean(ene_share_coal[which(Year>=1995 & Year <=2000)]),
coal_10s=mean(ene_share_coal[which(Year>=2010 & Year <=2013)]),
trust_10s=trust_last,
trust_90s=trust_first,
subsidies_2010=subsidy_pretax_IMF_gdp[which(Year==2010)],
subsidies_2017=subsidy_pretax_IMF_gdp[which(Year==2017)]
);
plots <- list()
plots[[1]] <- tt %>%
filter(Year==2017) %>%
ggplot(.,aes(x=gov_corrup_90s,y=gov_corrup_10s,fill=cluster,size=pop_UN)) +
geom_point(pch=21,stroke=0.5,colour="#636363") +
scale_size_continuous(range = c(1,10)) +
geom_abline(intercept=0,slope=1) +
#xlim(-2,2) +
#ylim(-2,2) +
theme(legend.position="none")
plots[[2]] <- tt %>%
filter(Year==2017) %>%
ggplot(.,aes(x=democracy_90s,y=democracy_10s,fill=cluster,size=pop_UN,label=ISO)) +
geom_point(pch=21,stroke=0.5,colour="#636363") +
#geom_text() +
scale_size_continuous(range = c(1,10)) +
geom_abline(intercept=0,slope=1) +
xlim(0,1) +
ylim(0,1) +
theme(legend.position="none")
plots[[3]] <- tt %>%
filter(Year==2017) %>%
ggplot(.,aes(x=oilgas_rrents_90s,y=oilgas_rrents_10s,fill=cluster,size=pop_UN)) +
geom_point(pch=21,stroke=0.5,colour="#636363") +
scale_size_continuous(range = c(1,10)) +
geom_abline(intercept=0,slope=1) +
theme(legend.position="none") +
xlim(0,60)+
ylim(0,60)
plots[[4]] <- tt %>%
filter(Year==2017) %>%
ggplot(.,aes(x=coal_90s,y=coal_10s,fill=cluster,size=pop_UN)) +
geom_point(pch=21,stroke=0.5,colour="#636363") +
scale_size_continuous(range = c(1,10)) +
geom_abline(intercept=0,slope=1) +
theme(legend.position="none")
# plots[[5]] <- tt %>%
#   filter(Year==2017) %>%
#   ggplot(.,aes(x=trust_90s,y=trust_10s,fill=cluster,size=pop_UN,label=ISO)) +
#   geom_point(pch=21,stroke=0.5,colour="#636363") +
#   #geom_text() +
#   scale_size_continuous(range = c(1,10)) +
#   geom_abline(intercept=0,slope=1) +
#   theme(legend.position="none")+
#   xlim(0,0.75)+
#   ylim(0,0.75)
#
# plots[[6]] <- tt %>%
#   ggplot(.,aes(x=subsidies_2010,y=subsidies_2017,fill=cluster,size=pop_UN)) +
#   geom_point(pch=21,stroke=0.5,colour="#636363") +
#   scale_size_continuous(range = c(1,10)) +
#   geom_abline(intercept=0,slope=1) +
#   xlim(0,1.5e-10) +
#   ylim(0,1.5e-10) +
#   theme(legend.position="none")
do.call(grid.arrange,c(plots,ncol=2))
#rm(plots)
plots[[4]] <- tt %>%
filter(Year==2017) %>%
ggplot(.,aes(x=coal_90s,y=coal_10s,fill=cluster,size=pop_UN)) +
geom_point(pch=21,stroke=0.5,colour="#636363") +
geom_text()+
scale_size_continuous(range = c(1,10)) +
geom_abline(intercept=0,slope=1) +
theme(legend.position="none")
p4
plots[[4]]
plots[[4]] <- tt %>%
filter(Year==2017) %>%
ggplot(.,aes(x=coal_90s,y=coal_10s,fill=cluster,size=pop_UN,label=ISO)) +
geom_point(pch=21,stroke=0.5,colour="#636363") +
geom_text()+
scale_size_continuous(range = c(1,10)) +
geom_abline(intercept=0,slope=1) +
theme(legend.position="none")
plots[[4]]
plots[[3]] <- tt %>%
filter(Year==2017) %>%
ggplot(.,aes(x=oilgas_rrents_90s,y=oilgas_rrents_10s,fill=cluster,size=pop_UN,label=ISO)) +
geom_point(pch=21,stroke=0.5,colour="#636363") +
geom_text()+
scale_size_continuous(range = c(1,10)) +
geom_abline(intercept=0,slope=1) +
theme(legend.position="none") +
xlim(0,60)+
ylim(0,60)
plots[[3]]
plots[[3]] <- tt %>%
filter(Year==2017) %>%
ggplot(.,aes(x=oilgas_rrents_90s,y=oilgas_rrents_10s,fill=cluster,size=pop_UN,label=ISO)) +
geom_point(pch=21,stroke=0.5,colour="#636363") +
geom_text(size=4)+
scale_size_continuous(range = c(1,10)) +
geom_abline(intercept=0,slope=1) +
theme(legend.position="none") +
xlim(0,60)+
ylim(0,60)
plots[[3]]
plots[[2]] <- tt %>%
filter(Year==2017) %>%
ggplot(.,aes(x=democracy_90s,y=democracy_10s,fill=cluster,size=pop_UN,label=ISO)) +
geom_point(pch=21,stroke=0.5,colour="#636363") +
geom_text(size=3) +
scale_size_continuous(range = c(1,10)) +
geom_abline(intercept=0,slope=1) +
xlim(0,1) +
ylim(0,1) +
theme(legend.position="none")
plots[[2]]
plots[[2]] <- tt %>%
filter(Year==2017) %>%
ggplot(.,aes(x=democracy_90s,y=democracy_10s,fill=cluster,size=pop_UN,label=ISO)) +
geom_point(pch=21,stroke=0.5,colour="#636363") +
geom_text(size=4) +
scale_size_continuous(range = c(1,10)) +
geom_abline(intercept=0,slope=1) +
xlim(0,1) +
ylim(0,1) +
theme(legend.position="none")
plots[[2]]
plots[[1]] <- tt %>%
filter(Year==2017) %>%
ggplot(.,aes(x=gov_corrup_90s,y=gov_corrup_10s,fill=cluster,size=pop_UN,label=ISO)) +
geom_point(pch=21,stroke=0.5,colour="#636363") +
geom_text(size=4)+
scale_size_continuous(range = c(1,10)) +
geom_abline(intercept=0,slope=1) +
#xlim(-2,2) +
#ylim(-2,2) +
theme(legend.position="none")
plots[[1]]
gather(ch,key,value,risk$vars) %>%
ggplot(.,aes(x=value)) +
geom_histogram(bins=20) +
facet_wrap(. ~ key,scales="free") +
theme(axis.title = element_blank())
corr_data <- round(cor(ch %>% select(risk$vars),method="spearman",use="complete.obs"),2)
View(corr_data)
ggcorrplot(corr_data,type="upper",
ggtheme = ggplot2::theme_gray,
colors = c("#6D9EC1", "white", "#E46726"),lab=TRUE)
z <- ch %>% select(risk$vars)
View(z)
View(ch)
z <- gather(z,key,value)
View(z)
z$key <- as.factor(z$key)
z$key
levels(z$key)
z$key <- factor(z$key,levels(z$key)[c(1,9,5,3,4,7,8,6,2)])
levels(z$key)
corr_data <- round(cor(z,method="spearman",use="complete.obs"),2)
View(corr_data)
z <- spread(z,key,value)
z <- ch %>% select(Country,risk$vars)
z <- gather(z,key,value)
z <- ch %>% select(Country,risk$vars)
z <- gather(z,key,value,-Country)
z$key <- as.factor(z$key)
z$key <- factor(z$key,levels(z$key)[c(1,9,5,3,4,7,8,6,2)])
z <- spread(z,key,value)
corr_data <- round(cor(z %>% select(-Country),method="spearman",use="complete.obs"),2)
View(corr_data)
ggcorrplot(corr_data,type="upper",
ggtheme = ggplot2::theme_gray,
colors = c("#6D9EC1", "white", "#E46726"),lab=TRUE)
z <- ch %>% select(Country,risk$vars)
z <- gather(z,key,value,-Country)
z$key <- as.factor(z$key)
z$key <- factor(z$key,levels(z$key)[c(1,9,5,3,4,7,8,6,2)])
z <- z %>%
mutate(key =ifelse(key=="co2_terr_pc","CO2 emissions",key))
z <- spread(z,key,value)
corr_data <- round(cor(z %>% select(-Country),method="spearman",use="complete.obs"),2)
ggcorrplot(corr_data,type="upper",
ggtheme = ggplot2::theme_gray,
colors = c("#6D9EC1", "white", "#E46726"),lab=TRUE)
z <- ch %>% select(Country,risk$vars)
z <- gather(z,key,value,-Country)
z$key <- as.factor(z$key)
z$key <- factor(z$key,levels(z$key)[c(1,9,5,3,4,7,8,6,2)])
factor(z$key)
factors(z$key)
z$key
factor(z$key)
levels(z$key)
z <- ch %>% select(Country,risk$vars)
z <- gather(z,key,value,-Country)
z$key <- as.factor(z$key)
z$key <- factor(z$key,levels(z$key)[c(1,9,5,3,4,7,8,6,2)])
z <- z %>%
mutate(key =ifelse(key=="co2_terr_pc","CO2 emissions",key)) %>%
mutate(key =ifelse(key=="laws","Climate laws",key)) %>%
mutate(key =ifelse(key=="subsidy_pretax_IMF_gdp","Fossil subsidies",key)) %>%
mutate(key =ifelse(key=="rrents_oilgas_WB","Oil & gas rents",key)) %>%
mutate(key =ifelse(key=="ene_share_coal","Coal share",key)) %>%
mutate(key =ifelse(key=="democracy_electoral_vdem","Democracy",key)) %>%
mutate(key =ifelse(key=="gov_corrupt_WGI","Corruption",key)) %>%
mutate(key =ifelse(key=="trust_last","Trust",key)) %>%
mutate(key =ifelse(key=="climate_aware","Climate awareness",key))
z <- spread(z,key,value)
corr_data <- round(cor(z %>% select(-Country),method="spearman",use="complete.obs"),2)
ggcorrplot(corr_data,type="upper",
ggtheme = ggplot2::theme_gray,
colors = c("#6D9EC1", "white", "#E46726"),lab=TRUE)
z <- ch %>% select(Country,risk$vars)
z <- gather(z,key,value,-Country)
z <- z %>%
mutate(key =ifelse(key=="co2_terr_pc","CO2 emissions",key)) %>%
mutate(key =ifelse(key=="laws","Climate laws",key)) %>%
mutate(key =ifelse(key=="subsidy_pretax_IMF_gdp","Fossil subsidies",key)) %>%
mutate(key =ifelse(key=="rrents_oilgas_WB","Oil & gas rents",key)) %>%
mutate(key =ifelse(key=="ene_share_coal","Coal share",key)) %>%
mutate(key =ifelse(key=="democracy_electoral_vdem","Democracy",key)) %>%
mutate(key =ifelse(key=="gov_corrupt_WGI","Corruption",key)) %>%
mutate(key =ifelse(key=="trust_last","Trust",key)) %>%
mutate(key =ifelse(key=="climate_aware","Climate awareness",key))
z$key <- as.factor(z$key)
levels(z$key)
z$key <- factor(z$key,levels(z$key)[c(1,9,5,6,4,8,3,7,2)])
z <- spread(z,key,value)
corr_data <- round(cor(z %>% select(-Country),method="spearman",use="complete.obs"),2)
ggcorrplot(corr_data,type="upper",
ggtheme = ggplot2::theme_gray,
colors = c("#6D9EC1", "white", "#E46726"),lab=TRUE)
View(ch)
data <- ch %>%
select(-region_IAM10,-region_RCP5)
View(pc)
data <- left_join(data,pc %>% select(ISO,cluster),by=c("ISO"="ISO"))
View(data)
data <- ch %>%
select(-region_IAM10,-region_RCP5,-Year)
data <- left_join(data,pc %>% select(ISO,cluster),by=c("ISO"="ISO"))
xlsx::write.xlsx(data,file="Results/data.xlsx",sheetName="data")
?xlsx:write.xlsx
??write.xlsx
xlsx::write.xlsx(data,file="Results/data.xlsx",sheetName="data",row.names=FALSE)
xlsx::write.xlsx(data,file="Results/data.xlsx",sheetName="data",row.names=FALSE)
openxlsx::write.xlsx(data,file="Results/data.xlsx",sheetName="data",row.names=FALSE)
blarg <- pe %>%
filter(Country=="World")
blarg <- blarg %>% filter(Year==2017)
View(blarg)
